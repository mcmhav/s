#!/usr/bin/env bash

csysUpdate() {
  if git pull; then
    "$CSYS_HOME/setup.sh"
  else
    git stash
    "$CSYS_HOME/setup.sh"
    git stash pop
  fi
}

csysUpload() {
  loggit "updating vscode config"
  "$CSYS_PROGRAMS/vscode/setup.sh" --makePackagesList

  loggit "adding to git"
  git add --all

  loggit "commiting to git"
  git commit -am "AUTO: update system configs" --quiet

  loggit "pushing to git"
  git push --quiet
}

csysStatus() {
  git status --short --branch
}

csysDiff() {
  git diff
}

# bash_completion
# https://iridakos.com/tutorials/2018/03/01/bash-programmable-completion-tutorial.html
_csys() {
  echo ""
}

CONFIG_HOME="$CSYS_HOME"
SCRIPT_DIR=$(dirname "${BASH_SOURCE[0]}")
RETURN_TO=$(pwd)

cd "$CONFIG_HOME" || exit

# _csys "$@"

case $1 in
install)
  shift
  "$SCRIPT_DIR/_csys/_csys_install" "$@"
  ;;
deps-install)
  shift
  "$SCRIPT_DIR/_csys/_csys_deps_install" "$@"
  ;;
-s | --status)
  csysStatus
  ;;
-u | --upload)
  csysUpload
  ;;
-d | --download)
  csysUpdate
  ;;
--diff)
  csysDiff
  ;;
*)
  loggit "no work"
  ;;
esac

cd "$RETURN_TO" || exit
