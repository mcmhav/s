#!/usr/bin/env bash

GH_STATUS_API="https://www.githubstatus.com/api/v2/components.json"
_gh_status() {
    curl -s "$GH_STATUS_API" | jq_table '[ .components[] | select(.id != "0l2p9nhqnxpd") | {name,status,updated_at} ]'
}

_my_prs() {
    gh search prs \
        --state open \
        --owner "$CSYS_GITHUB_OWNER" \
        --author "@me" \
        --json title,url,number,createdAt \
        -- -is:draft -label:blocked |
        jq '"- " + .[].url' -r
}

while [ "$1" != "" ]; do
    case $1 in
    status)
        _gh_status
        exit
        ;;
    my-prs)
        _my_prs
        exit
        ;;
    pr-create)
        gh pr create -f
        ;;
    *)
        gh "$@"
        ;;
    esac
    shift
done
