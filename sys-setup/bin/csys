#!/bin/bash

# bash_completion
# https://iridakos.com/tutorials/2018/03/01/bash-programmable-completion-tutorial.html
csys() {
	csysUpdate() {
		git pull
    if [ $? -eq 0 ]; then
      ./sys-setup/initNewSys.sh
    else
      git stash
      ./sys-setup/initNewSys.sh
      git stash pop
    fi
	}

	csysUpload() {
		loggit "updating vscode config"
		./sys-setup/programs/vscode/setup.sh --makePackagesList
		loggit "updating atom config"
		./sys-setup/programs/atom/setup.sh --makePackagesList

		loggit "adding to git"
		git add --all

		loggit "commiting to git"
		git commit -am "AUTO: update system configs" --quiet

		loggit "pushing to git"
		git push --quiet
	}

	csysStatus() {
		git status --short --branch
	}

	csysDiff() {
		git diff
	}

	while [ "$1" != "" ]; do
		case $1 in
		-s | --status)
			csysStatus
			;;
		-u | --upload)
			csysUpload
			;;
		-d | --download)
			csysUpdate
			;;
		--diff)
			csysDiff
			;;
		*)
			loggit "lol"
			;;
		esac
		shift
	done
}

CONFIG_HOME="$CSYS_HOME"
RETURN_TO=$(pwd)

cd "$CONFIG_HOME" || exit

csys "$@"

cd "$RETURN_TO" || exit
